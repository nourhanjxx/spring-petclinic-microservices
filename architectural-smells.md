# Architectural Smells (Spring Petclinic Microservices Ground Truth)

| Smell | Primary Service / Module | Code File Path (if applicable) | Code Line(s) | Labeling justification in details |
| --- | --- | --- | --- | --- |
| Insufficient Modularization | spring-petclinic-customers-service | `src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java`; `src/main/java/org/springframework/samples/petclinic/owner/PetController.java` | OwnerController.java:L73-L175; PetController.java:L62-L180 | Owner search, profile updates, pet registration, and validation all run from the same Spring MVC module, so distinct customer bounded contexts are collapsed into one deployment. |
| Insufficient Modularization | spring-petclinic-visits-service | `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java`; `src/main/java/org/springframework/samples/petclinic/owner/Owner.java` | VisitController.java:L62-L102; Owner.java:L65-L175 | Visit scheduling is implemented inside the owner package and mutates the owner aggregate directly, preventing the visits feature from standing alone as its own module. |
| Insufficient Modularization | spring-petclinic-vets-service | `src/main/java/org/springframework/samples/petclinic/vet/VetController.java`; `src/main/java/org/springframework/samples/petclinic/vet/Vets.java` | VetController.java:L44-L75; Vets.java:L31-L41 | The vets slice mixes HTML rendering, REST responses, pagination helpers, and a bespoke wrapper class inside a single controller package instead of separating responsibilities. |
| Greedy Service | spring-petclinic-customers-service | `src/main/java/org/springframework/samples/petclinic/owner/PetController.java` | PetController.java:L62-L180 | `PetController` orchestrates owner lookups, pet-type loading, duplicate-name checks, validation, and persistence of the owner aggregate in one transaction script rather than delegating to specialized services. |
| Greedy Service | spring-petclinic-visits-service | `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java`; `src/main/java/org/springframework/samples/petclinic/owner/Owner.java` | VisitController.java:L62-L102; Owner.java:L165-L175 | The visit controller preloads owners, constructs visits, handles validation failures, updates the owner entity, and persists it, accumulating workflow and persistence responsibilities in a single class. |
| Greedy Service | spring-petclinic-vets-service | `src/main/java/org/springframework/samples/petclinic/vet/VetController.java` | VetController.java:L44-L75 | `VetController` performs pagination, prepares HTML model attributes, and builds REST payloads while directly invoking the repository, concentrating multiple concerns in one controller. |
| Hub-like Services | spring-petclinic-visits-service | `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java`; `src/main/java/org/springframework/samples/petclinic/owner/OwnerRepository.java` | VisitController.java:L44-L102; OwnerRepository.java:L37-L61 | Every visit flow retrieves and saves data through `OwnerRepository`, so the repository becomes the central hub for both customer and visit concerns. |
| Service Intimacy | spring-petclinic-visits-service | `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java`; `src/main/java/org/springframework/samples/petclinic/owner/Owner.java`; `src/main/java/org/springframework/samples/petclinic/owner/Pet.java` | VisitController.java:L62-L102; Owner.java:L165-L175; Pet.java:L57-L84 | Visit orchestration reaches into owner and pet collections, adding visits through `Owner.addVisit` and `Pet.addVisit`, exposing intimate knowledge of the customer aggregate internals. |
| Shared Persistency | spring-petclinic-visits-service | `src/main/resources/application.properties`; `src/main/resources/application-mysql.properties`; `src/main/resources/application-postgres.properties`; `src/main/java/org/springframework/samples/petclinic/owner/Visit.java` | application.properties:L1-L11; application-mysql.properties:L1-L7; application-postgres.properties:L1-L7; Visit.java:L35-L67 | All profiles point at the shared `petclinic` schema, and the Visit entity maps into that datasource alongside owners and pets, so the visits module writes to the same physical database as the customer domain. |
| Unnecessary Abstraction | spring-petclinic-customers-service | `src/main/java/org/springframework/samples/petclinic/owner/PetTypeFormatter.java`; `src/main/java/org/springframework/samples/petclinic/owner/PetController.java` | PetTypeFormatter.java:L36-L60; PetController.java:L62-L124 | The formatter bean re-queries every pet type to map names to entities even though the controller already exposes typed `PetType` options, adding a redundant abstraction that mirrors repository access without extra behavior. |
| Unversioned API | spring-petclinic-customers-service | `src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java`; `src/main/java/org/springframework/samples/petclinic/owner/PetController.java`; `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java` | OwnerController.java:L73-L175; PetController.java:L99-L158; VisitController.java:L84-L101 | Customer, pet, and visit endpoints live directly under `/owners`, `/pets`, and `/visits` URIs, leaving no version prefix to evolve contracts without breaking existing consumers. |
| Broken Modularization | spring-petclinic-customers-service | `src/main/java/org/springframework/samples/petclinic/owner/Owner.java`; `src/main/java/org/springframework/samples/petclinic/owner/Pet.java`; `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java` | Owner.java:L65-L175; Pet.java:L57-L84; VisitController.java:L62-L102 | Customer aggregates cascade persistence to pets and visits while the visit controller persists through the owner entity, tying multiple domains into the same module. |
| Broken Modularization | spring-petclinic-visits-service | `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java`; `src/main/java/org/springframework/samples/petclinic/owner/Owner.java` | VisitController.java:L62-L102; Owner.java:L165-L175 | Visit logic sits inside the owner package and writes through owner entities, so adjusting visits requires editing customer classes, signaling a broken boundary. |
| Broken Modularization | spring-petclinic-vets-service | `src/main/java/org/springframework/samples/petclinic/vet/VetController.java`; `src/main/java/org/springframework/samples/petclinic/vet/Vets.java` | VetController.java:L44-L75; Vets.java:L31-L41 | Presentation adapters, REST serialization, and data wrappers for vets all live together, preventing the vets module from isolating UI and API concerns. |
| Cyclic Dependency | spring-petclinic-visits-service | `src/main/java/org/springframework/samples/petclinic/owner/VisitController.java`; `src/main/java/org/springframework/samples/petclinic/owner/Owner.java`; `src/main/java/org/springframework/samples/petclinic/owner/Pet.java` | VisitController.java:L62-L102; Owner.java:L98-L175; Pet.java:L57-L84 | `VisitController` saves visits by calling `Owner.addVisit`, which in turn mutates pet visit collections, forming a cycle where visit behavior and customer aggregates depend on each other. |
